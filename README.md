
## Case Study Questions

#### 1. What is the total amount each customer spent at the restaurant?

```
SELECT s.customer_id, SUM(m.price) AS total_amt
FROM sales AS s 
JOIN menu AS m on s.product_id = m.product_id
GROUP BY s.customer_id;
```
##### Result
![Result](https://lh3.googleusercontent.com/u/0/drive-viewer/AK7aPaBmT2Qrzp3jCH4rVbqNDM65-g4ediUIjUROQjRkYfAOTO29MQ-qiqXTlDlxr7Oa53ZoRIJzQFb0hDOGCXBG8sM73kUH7Q=w1860-h1005)

#### 2. How many days has each customer visited the restaurant?

```
SELECT s.customer_id, COUNT(DISTINCT(s.order_date)) as count_vst
FROM sales as s
GROUP BY s.customer_id;
```
##### Result
![Result](https://lh3.googleusercontent.com/u/0/drive-viewer/AK7aPaD52mpH2mf2vzPpwJfltXC_GEdEP-mTmBf_wDeGfBj5vcLeEhHmuBX9CTFk6bs-5kJa1uzCfjv1DzT9ItW8onF5isOUfA=w1860-h1005)

#### 3. What was the first item from the menu purchased by each customer?

```
WITH tempt
AS
(
    SELECT s.customer_id, s.order_date, m.product_name,
        DENSE_RANK() OVER(PARTITION BY s.customer_id ORDER BY order_date ASC) as rank
    FROM sales as s
    JOIN menu as m on s.product_id = m.product_id
)

SELECT customer_id, order_date, product_name
FROM tempt
WHERE rank = 1
GROUP BY customer_id, order_date, product_name
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDzAgVIXg5xRFJa1RBTdhgPPIRDzJZyi2auwj0PRnIBJcy944jFCTdM4mA4__sgpEeadEFM4cRuOM-AKnbhKlX1m0YX7XF0Apbwldy1MeC0Pd3Erzw8ojV56IgD7HkVOarXiqtBfh430YwBvrdxYrqDkZP7lAxCaJVhHH71rRbapZtNDQ6w73imNK3uw-EUnT49E6Q9jMm-vGDzJ9F5iWq3emAeINdc_VksN6pfHnUd6nd28OtJETRg44o_aXmK6Mv7hZY-zXnH7-awoA9Sw6ooeya6D4-FgwVxff0OjLeJTakliUgpPc4JXQXqMdIAz3ep2h6kBczqxA8j0KFGLrnvudDA20qqLrFBr3Idi3NuScZ13gQyxeIemMEuI8P2Zqo9G58X1pjOKPE_YucTE-PDS4G4418YHXd1H9G0ThAS8lPsRTBqnlwroZQKAwKtaCLqhYa5ZZaIx2IdQ3cxV9H05n1aIczDl_GRmRm6dosFRTLDIJeu0yLzMNwveu16qT3KIbrhVypha7zDxJuoyyVvh50AzHf4WGAMeCdjq8bPByMuXeTAV4Ad8PawAnXXa1JVTR9U9l2OkLVjvQ3_Z7RwL2gwG_h_wkcvFmV0OYq_j7ES5oHTtsdQHeL9l9KMPsancv1HrTgrhxiAtfofnaDPmjr2F0zmFIjb5Vbw2MtwBYCt8SyQzT9RKlxla84g4_suEO7CCfhAMVNznehICEfj0ncnt6t1RSVK3jPf7YeR4QDf601p0GlHOsAyj9dgYqr3k5xgINWIVqKtsPzyFfGznOLvF1JUMM7PMNkazgvJV3ntrfx7jVOGRdAQbpy7RqkqYEzqUF-qBrEnsTNZ-SdxawZvuSZUQOiY_wERAAxoUBjjuDbK9GYEij9JwfT_Db2wkQWGhaj_3xbj7DztegEIq5-nv7w6tL5IrJPeVFf_3Nw6SzfhISDPMMyuM2Cy8oPCbHETZ3m6NzPK9BAG1JIi4malj2JEz9yjai3-ZWxeWVby9UQb67yIWDuwb0JsmuymXmaDNJ7iz6Nx71kZPc9y_xUtAxrcmpHBVj1kQ76ou4eVgEeCdwszSexfLbjL1X8iPSc3vz2_DUJe6blFUxKquwB5v8lubath8wfL5SOkKZM9GslsalzEacLHtNgrsvHyNk6yoalrGOdDpg4NFN6z3JRD8FVmziRJ5Q-cbJ3scn-WoKV96ALCigqUVPO22U-TPy_Xszwow-y639DzK-fEWdVPMpWEUZVv32E2bV_CdyBhyZK-2ad99i_tSZbOWT5k0XNIWHnW3kp_712jzYJvHxbk3fz4IeQqWNQf62MnCXVedDBUwdC_r2kWcwIY7OmFp9hx79mKO8DcJ1OKjvduBIEpjmxQiF-jMYHSLf9m3szSUl_6inFmqWTeSH9srfm14wiWSBpiENbBm9Sf8tnfvwKskvRIEBJ4o2cp3wGM2IjPYfLlnO6CX9zCpya4UEncNIB0UUSVoF7MVuJssOafHRGCFX0nNwHzjEpdtkmhE296-DCcqFZkJwcMu1rfTj1AFcA5kNU3THKICeCOl-hoNmkItVsU4elegjI3TBsDxbCTvG4i8H3vhOtLNxpN4qtH-noinjpoqp2xK-N1l_6Ld4k67oQr9QvfOXJDLdXXsff4LrmkpqpNVaw=w1860-h1005)

#### 4. What is the most purchased item on the menu and how many times was it purchased by all customers?

```
SELECT TOP 1 m.product_name, COUNT(s.product_id) as most_purchase
FROM sales as s
JOIN menu as m on s.product_id = m.product_id
GROUP BY s.product_id, m.product_name
ORDER BY most_purchase DESC;
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDzwTtYLA5BKdkDQjIHPs1NewRjoSFuVq9pxKaQ8kzMUcfs2xuH_L-P-vSsUHfDizplrKaPuANLiu5uvhP9wUld3V5ZtNq6zKlhTphtNLblGXhOxAb5i72XX2CCeeZ26DgPGo3eC9Xfh7GnXFxA5V7Mznegx0McnnR0RGuCyeWHD6Px4hUFmCpeNJV4jD36wZ4N3vYS6cYpt8L8noPGFFCKE4d9rQdrumnLXTcCxCiwmsnaFKfWmW0SjmjRD2L_ogwLCJjfzUauKv3GzxUteP9HdbHjMUvDsyGZ2pudDG4ftybZLwq_Jv0TkAtEMkkv_AIrnZZ5LDzFPFqWGi2KTGl0qhZE9BDRUOTAIa7OW6lS6hqLv_-wtJT4fwNX0nUy0WDCvBR8UHAOWzXM_Gam23EB93szJC6lChzgBZ-Yxd7xMzqWwXAHzaPEFup0PXsmLgtXrgBhLAH2vk4fQJtH8kDLMI-R_yclO1Gbi99yiXtgg_mNF5ORWgACrfyMbv-W3cwk4Uw0PRrps5Wag-_9ma5KoBk9W5kAK-uXCqLOxIAuNMisD4_lhLUK9azLvm4wXUpBC-lBlV9P9lNDXsj2aJrASsty1GhFwWxW_pFoBIyo31FqfS0iDvYzRYFpmkHCuWZBfk6aHkBimvZvfaoFQnVYeu9E8BUQb4MiA18snvu3PBwt8kZAXlmnMb6sYUzDJcyrvdC9BpYavGtECHeiKqHhuCxrE6cuyEU14C6l0z9xXSPlgjqp6AbLkPpSCMlbhYCW36UvjtMRRZS1lKm0H3tayX6d4wqb1mOfZqsb3-lmozj9cA_XSfqcHSfOBRlMROsb5H6SO-cVciQleCtKK8PX8MQXYPHqMzDd-AOYejuJ_QdBre1dwtsG1f-O2F04YrDJRi2H8J0T9UODzl3G08Q7mWGEolH7EiPoNoBoNeLEFH7eRFkcA6hs50NEaGRFLzM5pQdGZaRgCEu7dd00izaUCvJyBJEF8XtiQbrzitPr0OegQLDO9LJUy8I9iA6bW1D1U13mMyp6osSd_XY2aUN2gNr96_KN8vN6MkNu2HsfmHyCLqh9g_QPEpa32RCW9UbSKr4CWXMshPsGONmsrfzMOddq81P3ZKQW5O68Sb0rmPyHjDL1DwbOEZDICuRgXFe3KaKxzNns_v4NZ9kL2T4qs4ElBKkDmHdlrERc0ueEgc_MVFwdrXrVW3v1xT4M1arl2up8rVzHkZxxqmdq_MkuLFy0gOpxDvhiI11usi9Bjn5UzLrosJFt21hLJYE4TB3D9vSpCjHjvE_JcHvmgxkqIFhWr9vlSf0sVxychVm0Y0fPR8qMVLi-ehqLB_re54zEF3Jz2vDWvH9wp9jDPSt9NydF4F5urBxzGZy_5DbafIdc6mxHaAea8eV0-zvZwTUnbHyHUxithWdDpFJJJzzulfI1KGzyt4bg-KbylzDDa0bRj8o1iYORRZ6MDfgThjRXwj9kf1bU_NUm59iMXGbqKdhts3vupbjAjkCetlSAM2xoC1T4rl1I65LucOlXxqgqUpVIAquIvsy0pHQvsac5h5VIqLw6B3yi1Vi8h-jXpVh6A_vmRqWMUcIFGnfnF_QzQ2JM7KFxZTOthn7v90dhht5JSK1nrXWs0-oELmiCwi_pQYRg0FKF8ug=w868-h1005)

#### 5. Which item was the most popular for each customer?

```
WITH tempt
AS 
(
    SELECT s.customer_id, m.product_name, COUNT(m.product_name) as count_purchase,
        DENSE_RANK() OVER(PARTITION BY s.customer_id ORDER BY COUNT(m.product_name) DESC) as rank
    FROM sales as s
    JOIN menu as m on s.product_id = m.product_id
    GROUP BY s.customer_id, m.product_name
)

SELECT customer_id, product_name, count_purchase FROM tempt
WHERE rank = 1;
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDzqjtBak_2Xd0ZCn_vEuNE_ilSZGyBsF6HHUxAbNuQbWRQb5_WFq5RKSKsVJI2i2mFeXM-juEhAuYHSyT0B3y0mw7HStZJSq1b2Fz_d-7UT-bPmRQIQGfCWO3fa0F_YGeOdcg_4fkzChgR4P0W1gJkrXV-gZvWszSk3OJJjnGeISmC3TUjTKUJojsESXzVHYKsx74PmRz3YOYiS0KAmAEqt2V-jtqE3UosTFZrA5-atFfK4EhTpecweJLVUd9fabj85qZACSYwzpSF6jAoMxBa7ctv5enqqvRS57vjRXvdHwujliz-9RxhtqZt94XGtkxPWRsaZUSESfySSF4IU76cjlE71xlujAbOgQINn5FzvZ3h8CfFpBib6tBVl9P-tDirfrYhjMbILrcz7m6bW0QbbY8bGvy_Ec4nye5u5NJg72S5j7QK4cr8Zi73U3pxAlOCcO1lQvwSYmEixn7ZPuF5rVle5HTI1mj_6CWpMuwEuwXsXsgir--4m9e8kUXgEbrwQUd3vdOWcgL7nf2likRF47O0tPlxaXwDGvSEOhQf_k-4hE-VCW5s8KkUefHifbyWBXWIwo9CnW2oQEJlIcNXZZCCM9h6lNXJbjJqS-XUVcp9GAGIlk6vIwCq3SoiKvybCk3ANrl_MxPNWuElfkVnD6m2Xd1UWU4SxR5NAaAQYSicM2UbXICqm4XAjS9ddgb1bge7I3mNgxEZxY28jyBiPcaxo8S2JuyrFwyIhkm9rADpTkAauD4-fmuMx919KOFc69TEC7wsH2Xfwhe9gIPcx0SXgk6xkWbcOt7lJlF3o7ItgU4y4g5DEOcNrqWQRFQ7Zi-7wE08qx567mRp5s_nr9AIEfBYY6W-BHZhfsTnD2B6e645DdfkwHv8fJO_-e2CuPBXZYRUjisnyWwThSiKl1fiUQyR4suYVpiKQC5cqdSB9hu835_Ih17WoESY29NWfGMDJ3E1XTqskP5T5MELR1en1cA7nDlLqzWyvLWODDDozNjVoyC1D9kRwZ0kmQj49vAp1rmP4z3fGzRTMbT6z1P9TtTz6Nvcl3V4PVPsylCc-A8tjHofaS8V6Z1ug-qxoh2M0XLuJJTmYFLNWLdVP3rqmNAoTxzih-kJBbYMF7gCSjgBggPvhS_cFJQ5oxT8AoSSUmpPLubLBxciUEiwOF11oroklOxeqop1awp5VnJwOsaJXQFc-q1-TEbh3aXYwf-ChxumjXfLjkMf_HX849CTdD_QwAdcdgWeAOoyvx_NK1hkCeVoKSUzrvErn3kLV4Wji2lN4GGcWIhRJYlwdQ_mnGtDEH8zRXMVxDKDAnacYBfyqv-vQto2V3uKYaKYwCJiyg1s9N0e3-F1AAVQfcPhVvKknFLVQAHYPB0JH7konBbBn_Rw_v6lmlotjyLOt3gJb4uVWxicCopgYo0IEdEu0gJ0N4dMC-7Z9VC2qrjQDf8J7Zkxu_nyNqYiulXpfDgiqNMLR-voU86ZARqqI4VL4s0nNVVW5YBGXb_-RTcc8IsyIxhEBdWevSPjFaKLFQIMmgkn5ZQeLXQzCZ6M1_BzcjZSOTKe9-juFBSXD2Pqk_IMsnOXuaWsnqJ7wHLzT5Od94qzFl_gWhYJTQYQ5HmFaHAk68wombjkD04NTXXI0S3twFwgukg=w868-h1005)

#### 6. Which item was purchased first by the customer after they became a member?

```
WITH tempt
AS 
(
    SELECT s.customer_id, m.join_date, s.order_date, s.product_id, me.product_name,
        DENSE_RANK() OVER(PARTITION BY s.customer_id ORDER BY order_date) as rank
    FROM sales as s 
    JOIN members as m on s.customer_id = m.customer_id
    JOIN menu as me on s.product_id = me.product_id
    WHERE s.order_date > m.join_date
)

SELECT customer_id, join_date, order_date, product_id, product_name
FROM tempt
WHERE rank = 1
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDxWbD6YPWttRlnvtLE_PfRqP0VJZnVoN5fzKB_TWb6aF1ecLE64KQG8gcH9HMWanUo7jlXHdcGUbWSE9hTWSpfoxvMnlJFYTm4MRHXl8fKTef7Mv4NN2_TxnH6ntejS72WeAmH3QIO_sgPdsQ4Wggly2beTa3GVDiWYK56BCPNx0YS5ROIgr_cJ1SJyegpm0YLLKVvDg-zQzYeq0vDtFNqtH7cASLUu_9CbmDGonQa-6mIifEuxQTGHmrdDmLZ9P4xPv9tDkwxnAuSsBgp9gYVGFRbu8FEr6llIQPEuO1lnC6wUIrCUyZ1Fq13eHwP_zt2h4wmbih99n6AdBJSBe292-vVhpFeyBQh0_a9BQF51U6yrQZfVL0yNQ3hzom5_TpIIgrn4il_3NB2KGUdKIgfo4DIchIb2q8AWVsdNXtceVBv0dQ4OB3zQTO2aVj_IM6qvPgBRtjGl9eKff1MkdbL4ObcDVi8lMk6lcJrY1NyyH3gDKKaVmT4vWZ9LBiW9MvWv62bEytsRFFZc1tv6_a-dTbZMNTaC-nHudlrCOO2Vb24ezkTTfZjto-kYJqSd5tM8ba3Q1XyAn2jkMsHB4g_vWc2DsaQ-tOQnzskhkz0vFTtjQ6yJOemezgJ2fFog1b1dUHPG9aR30irAhVtzBW0KLQGAPy-pYoBPdC6YkEvSsP8G6OytGHmB-t1Cf5o0eYs4rSUVYz-pcPvkgetQhiT8Fs6Qu2ZwfOGdxgbDCUWreehxWZcx5UfybvtiawuFc6P-IojJHCZxMfZPKrYBDDgy-Iyk1jDerGnUW_Cs-aoR2lon9w0tpPjDdfSLWnZsNME8drSMid2tK_zBSSmSz7Y-ctJgUbsPLg_TE1R04XeLadwsrSodthObp_OETd6VMV6_SPqkDhQmQqz2Eo5AQp06_AWOSgArTFJcnmj-_UyqqXPz4Y0InSFEPOW0BmR6aM0-NC3M4uF_X7X6yVJiI7QmYBkYmLEem8SmhEXe1wKx9-FLMh8pmij6sRg1zYV685gpibgi5RjghkHoUeP2fIv5C1X8csTennFT0zVCNidGdkBQV092gnWkdfN8XZ7_-uNFxEtiwSF2zXzpJpCLOyEmyt4Pha1BCdnTvtJItLLBfyCDEAwcfI0RvMdOF07yrWgxW9UVRY7iJOkDquH4kLIQw9j6ujlQgi1zE22onaRW9HBtwqtlJr8OCxEiX2QNLi7Juz0DDY4sV3XwJ0mHo0JDRYdz8pqci2A5GYwqB9AXTl0EAtgLFtK80LIa6NmxW2pAet3u4FOoGyGei5bfD1danM5xxkazJzgtsn67D_-WjvmHDhnqKByluIu2FAy2f44eTG1N7VsmkJRq5xk49y5WLDl3pbvP9hpRMkSbxgKamz257R4wGZJECkjNc1XPaJLDlpd0wyzI1ZtlX1LktUYBCHiAqF0B7BFoNi9YA2TU12Uw_gD2YDw6vaRxtPUFy7heAybc2_lcEVq82wLBrKnaxtFuGuF49axd70jJZLLR8ZIfGIecwGdV2bdr2JWq-xGPgWEB1aAwlhRaISK5XycuIGLPM64vFVb4y8TERU7vt_M-OlGmAf4bvMjMRGoLlc6g0AhuWiTMhpMCCykQ_ODyRyrWbe6AKJ1DAMy1BzUl2vu06o5sdEQoDA=w868-h1005)

#### 7. Which item was purchased just before the customer became a member?

```
SELECT s.customer_id, m.join_date, s.order_date, s.product_id, me.product_name
FROM sales as s 
JOIN members as m on s.customer_id = m.customer_id
JOIN menu as me on s.product_id = me.product_id
WHERE s.order_date < m.join_date
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDwHDADXSo9pDjl-Xo7lABabDUdu6q3G5B52ye3Ba6VcsEMUSA_nYsQ_AMDZFxyuzoFpoT30bD4RY6XAuGbyJ79L8NusPzDSW2TBEhPWTFmbi5Klf2jpvKN7AfeDGdjljo1VMxLT0hKPP2tGAesieTzUw_BHXC9wKGF0NKeCw2KjTisgsV6FFUaN3aNr5mHvcw7s6V-D0YHEE1srACFyp6DjOlkhUfxwBAEWrT1_ENFCa4s_F-GN0sD-OuyubMGm8X8mQF7BlVVKFQk3g08EMcHztv0AFrJ8TeSlF7c_gTAucHDu6cCFes52UZqR-QVBoSqzRHPOIjQw80xUeeTU4zn2LpAdlhKBaWhrLJC8c8PpDi0596tVo0MilUSZP916hsOnScpTiGVmjJjE4HtVy6I-dsEv3qNuEhFJSuUDx8yVUhMr4_ky1AWqHO0TIL9HW7ttH8XvB1GhHQV8vTI--QKuOUX-VyjLuPosyPMSo2sKbh9TkyQ--fQ71V1V1pA8HCIHofFe0mzoRzGruEgUS-xvvl8g2z7UT_IE_fW2pFiEMscCSsnzAhjZZSgDfOl5UAtYiJXJHO5NIrBZHNYb2gthiT4wMAu4JRqcC93wjB4xS3X_FFFIxwqDCKPo75G8VQ50RjKTBD5L7fJTeAelTLun5RSsEvxzFXKyvAelrDH57eU_3OH5c8F9BDQn_CHBX1P7n4bD3e-17lDU4Vf1vKnoxMJKq_466gCroG3pyxyViSoAIVXfAtJp3sBk3N453ogSz40_AnpEBqmZE1q6_9dEcuUtFEMT2c1WjpoH6bWdBKJMltT7gKYmvrw-4KqEymn59MLOux8QVDStvcHGQa86V42yXcs2Ib5QbWc-WCDjprVY5v4MPGjYnvoDlw_jhj0ccQADXvMOPMwCyOG02_qses5K7ngJGJLdqJuokKRmKji5xvl7fHNJ-yeVIgmJfJ98EVOP5CT-fDBcuqymLKxs-5N1EaEY5xGq4ns5vQLc9n0tfzFr62O17rYvbIOt_QIsKm63p2rDRfuEphAsJQztqTv9npcIPvk_AxSp_0utIO8mmNaLe-am4l20oIYTzx-mI0j418lyb9nRz2cAAlSkZyiw-BRP_S9DkcaXdc-pveeMAKDz9gYM2r7M8anxapGcdG73rvauHZqv_xP53pHfxSOuRWFTIKbGlwRsozZccTrt8Q_iNVvW5fePeQXABzGoWriD4P4m2OACzgKVwStRPetWVlnaqEhW2J-44IhOVQbRBwrGxIgCW6eCitKBd2cwlYYZY_iFJK_M2HvJt5Qy4P-C1IYbxbWzQvuOvoxD6ImBdMz1wxzbzTmdLxHdMM5PRlzk5qE0DGm8rkY6P2YS1a4VFNYnhYr2Y-qDKcAmV4dF747zmsT0Wz45yAvgBt-_p7OBsApyGT2Klvxjygp1xl9qpDmvrpVSoLWCu07z9_uHJiwNqw3GH_70-GFPIwIzHQdNJRMwqHDOcehHeHvlhvpjR3zE-dm6UGfyu6fUbkeTykrIN1kmVlNVSRG1XfJqHF68lI4dT9r9_tWzsSZakqc5V280KNXJKVqFQq2yfuTPrNXoWBP8x2_xhqOEi0ZL82cooL2OoGKO7uxCfNAAskCnMgZYYLXIAeZtzzCDQgcG-TqKvdekEQ=w868-h1005)

#### 8. What is the total items and amount spent for each member before they became a member?

```
SELECT s.customer_id, COUNT(s.product_id) as total_items, SUM(me.price) as amount_spent
FROM sales as s 
JOIN members as m on s.customer_id = m.customer_id
JOIN menu as me on s.product_id = me.product_id
WHERE s.order_date < m.join_date
GROUP BY s.customer_id;
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDz-5rN2DlE15jHohclcfPTYiG_thLicef3-h3JmFW4KuqQlDwaz2gPlaszVqN2O8pb9E4XwDRZBwuILKwWhWwj6x8OnXJ0f_uj3T71XsRjxSvWUo8q2xyUDedvk-Pi-KjCTO8et1UFBerVNVlHpbu0rewoy2UpadtgpNfivEMmNW8yNb0_R1tu3OTSFPhTUI4lDRMzTJxj95VrWag8Qn-tSgrqN8ImpZbSBNXEWgppmvXkw-EWlVMRbxC8GBUj0-xJvqreUnOFhq-iZzNf8Mojyva-pHkEGg-fT7mHDKpkNLqlSO5Rz3iAQKz1o1gnBoqV0e973n6SV-nE77aPkBZFwKXa0s73X5D-mgs37xISNlNhW0LKzKmsxrE2e580Cw9yn0gPpHFXUnR3BNzs_YjD_77cl2yVfDE4tZvy8z7sk76qQ_E4c_br-qQ051-_D4b8mxCnizJ-hn0uEtmafb5P9hnvIvm7--1jNYKsMoyYKIKkxu9VzBXqCHuPqwUiBQ_jQEatQ8ZELttY5TlhYpbsmyffthmgtK2G1q_21wxlXlOvnssib6v4Dj_0JU4feFZ1oXdKusb3_Djvd_FNyJjn_I9mHPETqwc4DfdrwunWETWewrI56eO_5y0i8HcB0iPQdER21zcYT3SAjQKFv4IOHQV6UQsT1FJO6cYuL9jk5NAgObuOaRv9w_Wb_HHQDXLUKiGPhXtZJF92h56vxYqSOm_0lDvxfehbMkwJXtoY1aEGuONfWKqbrIViXJvRinBsDetjdWCgyvp2BNtIUkVj7xdZBuUsdtrP2yRoFAxYrxhumgkMhdg2NzrWsxsHKOxs28FHeh2JYUgf34f0aNCgZaPb8Hu11EusuwphZH8cBU4QymF48o2iHEaPjUNu1c8cZs2qGXJRA6v8SE2vnzIxmsSBFETPm3fU0OY4P3TYve0YDoviGctV6mApLkHkqLwSfv8UfM2DxOMLl9NR5pzOGqDWW5NXuC_tu2OF7aUa-1zP6srwJ3F_J6q5wuMazcWYtmGira-u9jD0Uf1hKCqmII_yGatxEoPMzs43IwBbHrDuG1fhJgjWDrucMnqaLXj1PoFgsTnuj2O_2NFLZqheOrvQkUfLi7r-QMzWfaobnw9PYbeXKlgxT01k1VRvYgSdGRg9cW05Hv7p9-O63wV0-xOFgoUiLqC38547AK7Qez37niVlOYwQi53fhlnHWreXYBLv7NyQNon07Wcbp0tvmBvWiDSfUHEZ0cHL_q13ohwVUvpEzkVUhZu6RPE3KuwHxisayo0JoF4WhSBBr_SHNm1-85vTPUIBCY8GlTdqjRiypQW6MkhC0P8ySQNfZCL6KoWwHfvBSfORjZ4WVGq-UjUTE-53VpJ7sMlCaDyJqDoOV-giTErhJC0XFyHfM9OEu6NlNQ8bmdTjN8cdPK-vOmCO6NDWzj1-GOXCUNC-PbfBF-Z584zEhnletWt5T_UcFq8GsNj9_-Nx5Kqyw-wMVRX826CiHNgQXlHtcgbGBf3vzGeoEvcZ7DO95My0PhRfj3OHGt_giy1P6vFHLdMwO7epuewdiVDZ02VmCqWNaTZwa-xVwaIL8BPSM4CV6NwNysDZD8ewef0n_3DTtncEBvq8LjigCiLgLX973nUYPGenPcA9nhPuH3A=w868-h1005)

#### 9. If each $1 spent equates to 10 points and sushi has a x2 points multiplier - how many points would each customer have?

```
with points_table
AS 
(
    SELECT *, 
        (CASE When me.product_name = 'sushi' THEN me.price*10*2
        ELSE me.price*10 
        END) as points
    FROM menu as me
)

SELECT s.customer_id, SUM(p.points) as total_points
FROM sales as s
JOIN points_table as p on s.product_id = p.product_id
GROUP BY s.customer_id;
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDzfwqRHE7U4NCwV5ivxo9CDneXDSRVrof4MpCwmtWnzDAqR3FZLeaMVf7JsPy8dzIcIKJJhMmK3HpN50r7X0J0M50ieEWkCtkzR5UAg96BxslSa7bQ3HZWsqXlyjuk27My-YjxatWF00EYNGDqH1mK7et0PXwncARBuimhQEDazw90FfapldlZ01XB2eoTqv8LTAOEd7N02sRvYxLJT3nPimQEP1VZPNaTuDpD_xYrL1gC23jGW-QL3gt0j_PmnDKckLyv4iEhiyvPHPL5XPAFtQ34pRxjZm0TTAYCPiN_wQJX28SzCyjxTwfdREi-gU6SIVoidBoFQ-IqtQlW6Rjchu5NptzUHItqpdN_rB37PcOJdrIHEQEvrCQb7g_t7vuWOW44luqYFyrnlutjveAw64960teiwuY4Nvg3VSp2UZAYSGXd7LFGg8TzdpLLxJCKUfMnckNFCdjVp1dIF9MgmszkHwGvfvEoguTH8eg4WEPGjHb2UN9f7RyYiTHPYEZ57iCJEtzRxosBJh2P8sBFybh3b2LQpKI2zYfVPW59jAN7bMAo2hxTGaec3VhHShqKytQ0rYIeFgwqfdkPPMhoDoIf2WGWm61sGfUCLQJkPDYYHPx7ifNcIk8LoKTznJoxOAS7hWUPlXFxXy0pUQL4EM4MJ8ey7QOY9mAr0eSChLg-8mb1GkV9ym-PvsuzBjpq8EuQoIlfeCB4chONjnr2UQkKB1b3BY-S9hys6M7a-Vs2F0b6U_KTJVdtZ_0i5kB4muuddKC9waHVBLVQYWRMDNDAnK107Y1xIV7w-dXmCLwaaVCa4tCwVx-wiR7eag8SBWWwKANK4X_pInQ62EgjsmnDT6KCXQ_umywlXo7D649gYnBRDdKyIt-8VZ_A3qsmXINk7d_h-gM169xxslkGLZn_1DUozJmtytrVnv-uWhVMa1zU7aU5LNtHM01Isk0dVTwfWMHVzVuRieMkAm6kjn4-U4d4Z-8qtBzwVzCbDNzCE-aezRqVUkHTr2n_rh27nlx7yQqqb3WSr7wEMga_ZzbonEHdirMcx5JSg0tefUTn006oDQAfr8Mhnn-yfa6XQ2SKpDzKBDyX6L3JWR-nqlXsHHEDUsy8WagZcFxd0ZrO4gibiTwvkszsJentH2LiW4IPA-vGJ2kDxALdAmPXpDBniBWzUcKi9vLiZswdknd6aUGfNurdp2hqRm4gm82f25m-cLmHi_-iHyMWMmUfG2yQNEa2CNiA2NLpo-ZnvaKp49XRiIbtBbcC_Sya_0rEibdXkDo1TXlSKjQ3AQQSkmARPanauIfz6t-K_VB4spUkrioen228tWNFFA8cM_EDiTrOIuyz4FWXx7q4CgxefWD2Wg44xwdG1AzBdigeCbiGOwd38JLbY2IKJQUoXezDDQH2Sm8wbutMlrpw1cXWThAqP2dtnzbyytxu1pvKEKYyDrozIGnvK3Gm0soMUr8sV-Dc8GR5Ou66BHJWHM8C4Dh9TxHR5AEXWIaOZDCWiw-U3PkjliJcs8Os7PyN1egS_RYelGm66tefjGP_D4KgI0nLBn0pYXo6msPf8RZhjH7IVxcgQ9QBFUoQHFW4RcQf5XZhKI4spWSP6j3JtxNZztzLpyYwOA6PB5RKoZz4ifHhEgu3aci6vdQ=w868-h1005)

#### 10. In the first week after a customer joins the program (including their join date) they earn 2x points on all items, not just sushi - how many points do customer A and B have at the end of January?

```
WITH tempt
AS
(
    SELECT s.customer_id, s.order_date, mem.join_date, me.price,
        (
            
            CASE When DATEDIFF(DAY,mem.join_date, s.order_date) <= 7 then me.price*2
            else me.price
            END
        ) as points
    FROM sales as s
        JOIN menu as me on s.product_id = me.product_id
        JOIN members as mem on s.customer_id = mem.customer_id
)

SELECT tempt.customer_id, SUM(tempt.points) as total_point
FROM tempt
WHERE tempt.order_date <= '2021-01-31'
GROUP BY tempt.customer_id
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDyEu01oXiBcltruhNOwUMZdWf7oYleLbQxcsYiPTiMQQGcqaIEwN6VS-z4gEF6Q6ChdVfAVIB11DF0CEBf5muivkv-X0I5mote0ELueS-2trgt0T_AIUR1z92jONPBqFWGdNGMPp_SRyzZUz3TMgC_MclNwk1U4DudsHxRCZXm66o_rq3gLuIPxyiCDeWqyTyPFKDQOK6sXD3GaoMEq8_h5WEdhqP9e8trO5mod6i9_3FRtp6eewtraE31ZuMtaINBKeOLs2_Yh1KSAPRaNCBzjCf-zQKLXa_hGWOGaaDAPPQ06e2uc5JbApT9xbarpiNT0arNPi6TQI-fu8hcr8IywkdUwVQ1ay_XBK7IGLB391uJMQh9TJ8sJvi-IEz4jRlXCB3ybh6Htp5ezS1HrFrAHzYkm_9DpjzBzODyIuIqXDZLrZvFST5VstVxDYddQToPm4lDsAKQ9raLIySplZjG9crwh64lamY1jYi57p4NNNaLHpOJtv6rtfTeILwFd0iEu2RwdAp_AUKveAesp3YALjKMt19dB2VfPXuW6Qb2UxrY6eEU7eO0VEA8IMpU9HR0cQXTHh2ISAy42r4q5Of2896__2T_ePLmhg5FEALpztZHUbAoampzPNmlBiPr-pPnIFCb0pnxCmVdrwhv_hA-_aRMgCCuhJ4mWYB18ikzoCXE-H-rs6b9QoROhiZYbICmSWVf0QV6-SDs_711B5omb2xj1hcpJRbtDw_D7JFRtyKDAh_kapklPpPLPEBXV6dm_B9NybQE4Gg2AWhDf19NCY6EEkBtF7y_IcyyNDwIct147MABtIMsWyweshR_SddSms2B9Lg0WdOqwH03AijCtiw9-so2OEyM6IUjsF0yOfwf1ZcWjMYBxsbnfuX8wJltvrx9YDPH_fD9fxbWC8SnQfs-s9bAL9ghy3-rZNhpGP7EWEr0IlgK9qDa8eS4-_wV-Zz0hHL_Nr9NQQQ58BqZ0kD9ZURRA-70GdR82iuuxTiOIg-USH3Db1sFqoeMeGXX0uct5-L9RwFe3H3w4nIM5EWEt4U-s1h8wAIF5Qg-OMzVat7_mwKPtYK0IsdfPFW4Cjq86Mx6GvjftBd_6geuNPvHYbCJAv05MgmhnuwUUA-wYB92GhIoG7QpxMnm-A-m-V1kF-5ODFRxUOscYEbD_wjLlZWkhzV7Y4uTZP9cE7Da4FQMgAMA475eNmw89w8INMwn4l0wroCMvVeGWA0pNRZE62APYVYfaF_dfbLoxksbhYbTtkn54HtgNUBxBzv_L84GGN6-bINoB-Pauu8f_S8XyjsPbRNnCKQhrUSXpnNUc8ZmHp1dgNmEAcrelHT3n652niiCupuDm1zggooLfrMpsaDM3vonpKZnGjp0Ndk3LmrIIIi05XznxZ7tHKK_NuQrpQbUGJBgJwFPUSR61AnupwshZ52RjFONN6eh8yuj2UIFYFyyar04erFrJc2277CL33saHkD4cYfp5a1L_oOE718oZ-HE1j2CHjah58O3Sgw94NyhkVwjSbHoI-h8G3_hj28zBuRQv3-3-Y4ZL8XTwj8p1OORmsyiAHfZ1Mtyc5GB36venbgUGnmnbuHognlvskBkyhjUxoycB9DIXRrHjKfKxTr0RFf7PigGN8w5yr3hxUyLWJQ=w868-h1005)

#### --Bonus Questions: Join All The Things - Recreate the table with: customer_id, order_date, product_name, price, member (Y/N)

```
SELECT s.customer_id, s.order_date, m.product_name, m.price,
    (CASE
      WHEN mm.join_date > s.order_date THEN 'N'
      WHEN mm.join_date <= s.order_date THEN 'Y'
      ELSE 'N'
    END) AS member
FROM sales AS s
JOIN menu AS m
   ON s.product_id = m.product_id
JOIN members AS mm
   ON s.customer_id = mm.customer_id;
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDw-8919sxvnmZlkDCJSngY-TVHRaP7dGrS2TMv4l-YzaImCQVukjeY_TLOiSCYtbdb-omeazVnyK_yR5BON6_08TcEF9I_wOEHps6LyCR6PkJLJWgcxHAGMXJNC-kzYKgvMKpSdHrSFG95fr37GQzIqFo4bkc9GJ1kx3uT9MeErKFtCvbKhI-Eojx5TeAmK1uVDTYl9f8fKfQRzDOURf1eb2rJtiKKvWehT4y_klQTtzyP_sBL9NgseGuKI0TXQrd-WjQVWG324fc2XIj7LqW9RJfEHMdMSkHkZ5u-zeQsHhvIdBNrmwJSzTzWqvG9CEBvztkSNhEQXhveCCbWA0eSuMHGXW-5L9_vXiquvwvv_TbE2iDK02T-tKoH6XFWVyghLEM1nppkUWqVJXPYHVXLWIdj6wcDai-FNdgxUno4a-QLPjY3NkRDdc4lBDQJg86mvUudvj_fxvLVsivqjUgB7eoKDmAr7yrufwmf88kky7BWk6wM1dD9BW1f2oav3sLr_bCT-beatl_uF8g2zuJ4F-PYVv_-ga-FTJtGkkCLH71oiDiJ-hGtsdsjc1ARGTZmLYErHmTJC-KLEtgjvB7DaV0y5USlICzPyMo8rQHzEfRwjoWxuWIHi5MP5kLQDabH-j5tWaATfFu8eVu2b_CJ30oBdb-qmhOoEHJ7zNK4tdWILLueYNQIrw3ssT6S2G_BMoiMCGNYTYTtg8HIFW5FG4PGdECDj47gyO3Fy3i06HV1wIPLQd1XWCVNfPUN3pWzelS6WqAadBUCQ4q1s_w-wNXhbXwXGev9WPzoEOTItsf0BUpMoGauMgQavvZFpS56o61rsPVbskbrBSOHoHflhRmXJ8qukuhbe-ud88yT27t4xcTtXFH26FD8anneYIqlJEzVD5HKYhPXyOTSgaZGR4MYDyNhfFhNgasnyllLvBUHfjK63xvWkRwRdQdRb2dWZrEnnOkH36T7WSyPdwObi4pfCZGenTm1GN7eso2xFXiNjksFJf-g3M0XuZDsZWXKPWpatXlUEjnqYHMcAvM8odTWVDKm9Kk979k5g5EV_uJturNdgEZ92JuL788OQz3JGgllAx6tLVQlqpPAYCKQFgN-hEe2HqSGun83wOArYiVu13T0mxhJ8oilqm6CU1pY-5xh7FJPrcPJWyy9MTRpUUuLlwcLPmVaqjH8FOuTm9EFD86nWHMnEq4oex-JrnVwZPufuh2BoCfnPRnklrfIh_SwId32__bUACAHVF0VQ_JwmXaYhvkJFej2CPjCyRlgvuxRdLFnHKmkQM1eegEjfYT1MOEyjPZbXehA3p67H0z04NtIBEGh-aLFI2WHPvba3xFOu8uzcmmG9BanHWOySym_bxmcVTj9srUoXBSy6Xw9bXa2EBKh8woditgldWEQtNgYcqfD02MhoUVNPuYZbOtTEpy7p3jC8OePnu0y-HHYpCmDdbHBCmnjxuqxrCGpmINZy_upqmLWLZ5C2fnR-gR8uHUcZoM80_2YZsq9_U3L-ucjenBnQxZ0ss3U2q7YDSd_Rzop9Jf1JZZfvp6RypnnOcSmRvd2PcIV6zJHV0VZRNLPZVzFMKFf94ZWPPEVCWZpdNhYXcugCosbRLrv0PPc4Sdu152P-aDRGbIRzv_gPAplVzRZSrQ=w868-h1005)

#### Danny also requires further information about the ranking of customer products,but he purposely does not need the ranking for non-member purchases so he expects null ranking values for the records when customers are not yet part of the loyalty program.

```
WITH summary_cte AS 
(
   SELECT s.customer_id, s.order_date, m.product_name, m.price,
      CASE
      WHEN mm.join_date > s.order_date THEN 'N'
      WHEN mm.join_date <= s.order_date THEN 'Y'
      ELSE 'N' END AS member
   FROM sales AS s
   LEFT JOIN menu AS m
      ON s.product_id = m.product_id
   LEFT JOIN members AS mm
      ON s.customer_id = mm.customer_id
)

SELECT *, CASE
   WHEN member = 'N' then NULL
   ELSE
      RANK () OVER(PARTITION BY customer_id, member
      ORDER BY order_date) END AS ranking
FROM summary_cte;
```
##### Result
![Result](https://lh3.googleusercontent.com/fife/AK0iWDz1pnqXtI_Q0OhnZEnXDbgaJRDjPe7QXGFjP3tA-i0pDvXE-lZLSpH693_kLUqKiPrC-bGX-B08ROUvP8SXokEVxUdI_rKJTFEXOvFHQGvk6yRGA2GfkQ_A1WinRjP-nMYiIQ2WO928wIUwehE3-BN8m0ioj1wN3dzbZkBM0mJiJcUHRBlc6Ng5VejzUr3vsETq6YQbsu-0IWpIdVRt1Diz7l94eXIqJeE4sboVRGybMaFO_phcbRU3ZP0Dpl9l39_6_FVhuUDFU5X3HcG7dCT1l_dJw53t1ZyE4pRxNEcUH41rFCowZH3-hD0hltya8zLrLDo-ayCjG521mm9dri7JhCNbTwpkaUyLk97-SUKMFURyDWVa1-U5YwKQt7aPyGP3hyAyR_7J0F8TLID5fSMwRP6YcLbiA2fN4UwDASaYYXBkNu5HuFo_K2rdzY3EE3P-sJn3thUyde0fVPeGRltGCSTLHuiDWMs8JrRHL5C1yLgOBzDYvBAucfBoO4Ut-HjR1GdECehSBWsC6o4NBezQPXYCKrj3aaCpaNNoyDF7fjiYty_spm6C_AU58PeZL2O5PSGcuQycc7Z1yWqjSKBzXFSi9uw7Jp9VMLvrpoKI6ifl0POvaoWDmicQj5-TbYrxvck2eqj8mwJjulFD--oPewplCXn98ndpYsHlixVMI_jZ7e7G4AdwxoVh8UPB0b_0XFc_-Mm8IDayjYyahrPeH244aWpr-JEg_vtBviTl5Ce6A3nhRXYOKQ2R8M-jb__3XDtcu30wxn6R4E4ULwO_MnHaFdFYZ3mg-6TX0X3FqRKZYzV2R7-q92AmEUDWGruiq6Ah6zDZPR5v61BLj5hiMEC8omWc68USq2vVeVDVpkYvNOHtkpNNBBJNmnyYwoU_n-nmkiBkCsKtRjH-QECFMvNt5cizgvIRDFqokt1uTKF4s6j3BwqkH_uKB0OfypT_dThEjI6dTgcQnmAYyDnFHz1pBj8ixuqr1pvcAdVtzBmTiGqfNDgbgOUx_du7N3uzH0gqECL0PxWOczWSVNk0PEpmv66L7oHEHi4lmAME98ayUNR3ahL0wRp1W84Se3waNqItJI50DeVKGWNrOzefXimUJQWbN3kcppaCemoz1oNRtYvU70LexR7HG1V8NErcrnHqitdSlHnUiD_3Rs_tRtbhmprfSxf2dfuL2NJzy_Dkw9HuLsDRkyos80jVn0Mm0DG3oujehKgetraWiFGe2PDan5M5OFyHiuwtzy9Twu9r6m7tclHu2rhC4bC0v5hDq5c7xTG_MeUafTAhMGUCMENM9FePQm0_ZgJSwIWSDQ42GnAZKNOMckS96C6kE77ZeoLybbWLL2HU7z0O80UVkXgDEaO25BaQGMLfbveA0TlzUgm6ZOPh3T_n_E1xEFyYBFTpGZPqf4eYkn_qgutuGkJViZaLvzp4IMbjm1QwYWIdotqQQwAp9f4V_J0Kq-NR84rv1_lwQSByjYqVGCpngXoem60c5z1k5j6wLhFCYPiKCly6IuLJgDqRzO7zcGXmg3sY2mnYuaHQTuPN7PWpFXEIH3JtEBn4nniLNkQcYRxi-VgXkGXh7PQOo7F7pB6bKyb14iQRBlbpBW_W7RwI-l3F7iT2RmIg6yV6fOfI7ftJ46c2PTV0vw=w868-h1005)



